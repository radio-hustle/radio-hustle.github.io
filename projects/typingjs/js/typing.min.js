/*
 * Created by Kirill Tribunskiy
 * octav47.github.io
 * tribunskiy.com
 * mailto: forty-7@yandex.ru
 */

!function (e) {
    e.fn.typing = function (n) {
        function t(n) {
            n.each(function () {
                var n = e(this), t = n.text().split(""), s = n.hasClass("is-visible");
                for (i in t)s ? t[i] = '<i class="in">' + t[i] + "</i>" : t[i] = "<i>" + t[i] + "</i>";
                var a = t.join("");
                n.html(a).css("opacity", +!+[])
            })
        }

        function s(i) {
            var e = d(i), n = i.parent(".typing-wrapper");
            n.addClass("selected").removeClass("waiting"), setTimeout(function () {
                n.removeClass("selected"), i.removeClass("is-visible").addClass("is-hidden").children("i").removeClass("in").addClass("out")
            }, v), setTimeout(function () {
                a(e, u)
            }, C)
        }

        function a(i, e) {
            o(i.find("i").eq(+[]), i, ![], e), i.addClass("is-visible").removeClass("is-hidden")
        }

        function r() {
            e(l).addClass("typing letters type"), e(l).append(p.text.before + '<span class="typing-wrapper waiting"></span>' + p.text.after);
            for (var i = +[]; i < p.sentences.length; i++)e(l).find(".typing-wrapper").append("<b>" + p.sentences[i] + "</b>");
            return e(l).find(".typing-wrapper b").first().addClass("is-visible"), t(e(l).find("b")), e(".typing").each(function () {
                var i = e(this);
                setTimeout(function () {
                    s(i.find(".is-visible").eq(+[]))
                }, f)
            }), l
        }

        function o(i, e, n, t) {
            i.addClass("in").removeClass("out"), i.is(":last-child") ? (setTimeout(function () {
                e.parents(".typing-wrapper").addClass("waiting")
            }, 200), n || setTimeout(function () {
                s(e)
            }, f)) : setTimeout(function () {
                o(i.next(), e, n, t)
            }, t)
        }

        function d(i) {
            return i.is(":last-child") ? i.parent().children().eq(+[]) : i.next()
        }

        var l = this, c = {text: {before: "", after: ""}, sentences: []}, p = e.extend({}, c, n), f = 2500, u = 100, v = 300, C = v + 200;
        r()
    }
}(jQuery);